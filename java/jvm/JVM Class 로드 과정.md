# JVM Class 로드 과정 - 로딩, 링킹, 초기화

## 1. 로딩(Loading)

Java에서 클래스는 프로그램 실행 시점에 **해당 클래스에 처음 접근할 때** 로딩됩니다.  
이러한 "접근"에는 다음과 같은 경우가 포함됩니다.

- 클래스의 객체를 생성할 때
- 클래스의 `static` 메서드나 `static` 변수에 접근할 때
- 리플렉션 API를 통해 클래스를 조회할 때

이러한 작업이 수행되면 JVM은 해당 클래스를 <strong>클래스 로더(ClassLoader)</strong>를 통해 로딩하게 됩니다.

### 클래스 로딩 후의 동작

클래스가 로딩되면, JVM은 클래스에 대한 다양한 정보를 <strong>메서드 영역(Method Area)</strong>에 저장합니다.  
저장되는 정보에는 다음이 포함됩니다:

- 클래스의 이름
- 부모 클래스의 이름
- 생성자 정보
- 필드 정보
- 상수 풀
- 메서드 시그니처 및 바이트코드
- 접근 제어자 정보 등

이와 함께, JVM은 `.class` 파일을 로드한 뒤, 해당 클래스 정보를 대표하는 `java.lang.Class` 객체를 힙 영역에 생성합니다.

### `Class` 객체의 역할

- `Class` 객체는 힙 영역(Heap Area)에 생성됩니다.
- 이 객체는 **메서드 영역에 저장된 구조체(Class Metadata)를 참조**합니다.
- 개발자는 이 `Class` 객체를 통해 클래스 정보를 간접적으로 조회하거나 조작할 수 있습니다.  
  (예: 리플렉션 사용 시)

### 참고

- 메서드 영역에 저장된 클래스 메타데이터는 JVM 내부 구조이므로 개발자가 직접 접근할 수 없습니다.
- 따라서 Java에서는 이를 감싸는 `Class` 객체를 통해 간접 접근 방식을 제공합니다.

---

```java
// 예시: 클래스 로딩 트리거
MyClass obj = new MyClass();        // 인스턴스 생성 시 클래스 로딩
MyClass.staticMethod();            // static 메서드 접근 시 클래스 로딩
Class<?> clazz = Class.forName("MyClass"); // 리플렉션 사용 시 클래스 로딩
```

## 2. 링킹(Linking)

로딩 단계에서 `.class` 파일을 메서드 영역에 로드한 뒤, **JVM이 이 클래스를 실행 시 사용할 수 있도록 내부 구조를 연결**하는 단계입니다.  
링킹은 총 3단계로 세분화되어 있습니다.

1. 검증 (Verification)
2. 준비 (Preparation)
3. 해석 (Resolution)

---

### 검증 (Verification)

**class 파일이 JVM 명세서를 잘 따르고 있는지 확인** 합니다.  
누군가 class 파일을 악의적으로 수정했을 수 있기 때문이고, JVM이 안전하게 사용할 수 있는지 마지막으로 체크하는 단계입니다.  
예: bytecode 형식, 메서드 시그니처, 상속 규칙, 접근 제어 등이 올바른지 검사

### 준비 (Preparation)

static 변수들의 **메모리 공간을 확보**하고, 해당 변수들을 자료형에 맞는 **기본값으로 초기화**해 놓는 단계입니다.  
(ex: int → 0, 참조형 → null)

### 해석 (Resolution)

클래스, 메서드, 필드 등에 대한 **\*심볼릭 참조(SR: Symbolic Reference) 를** JVM 메서드 영역에 로드된 클래스/필드/메서드의 정의 정보(메타데이터)에 대한 **\*직접 참조(DR: Direct Reference) 로 바꾸는 과정**입니다.

### 참고

- 심볼릭 참조(SR: Symbolic Reference): 실제 대상(클래스, 메서드, 필드)을 직접 가리키지 않고, 그 이름(문자열)만으로 참조하는 것

- 직접 참조(DR: Direct Reference): "객체 인스턴스 주소"가 아니라, JVM 내부의 메타데이터(클래스/필드/메서드 구조체)에 대한 참조 (클래스의 경우 Class 객체)

## 3. 초기화(Initialization)

클래스가 처음 사용될 때 수행되며,
static 변수에 <strong>코드에서 직접 지정한 값(= 할당된 값)</strong>을 넣고, **static 블록을 순서대로 딱 한 번만 실행** 됩니다.  
(JVM은 이 단계를 클래스당 한 번만 실행합니다.)
